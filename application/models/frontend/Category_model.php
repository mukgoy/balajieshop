<?php
defined('BASEPATH') OR exit('No direct script access allowed');

class Category_model extends CI_Model{

	public function get(){
		return json_decode($this->get_json(),  1);
		
		$this->db->select('concat("[",group_concat(json_object("title", `title`,"cat3_id", `cat3_id`)),"]") as `cat3`');
		$this->db->select("`cat2_id`");
		$this->db->group_by('cat2_id');
		$query = $this->db->get('categories3');
		$categories3 = $this->db->last_query();
		$this->db->reset_query();
		
		$this->db->select('concat("[",group_concat(json_object("title", `title`,"cat2_id", categories2.`cat2_id`, "cat3", cast(`cat3` as json))),"]") as `cat2`');
		$this->db->select("`cat1_id`");
		$this->db->group_by('cat1_id');
		$this->db->join("($categories3) as cat3", 'cat3.cat2_id = categories2.cat2_id', 'left');
		$query = $this->db->get('categories2');
		$categories2 = $this->db->last_query();
		// $this->db->reset_query();
		// return $query->result_array();
		
		$this->db->select("title, categories1.cat1_id, cat2");
		$this->db->join("($categories2) as cat2", 'cat2.cat1_id = categories1.cat1_id', 'left');
		$query = $this->db->get('categories1');
		// echo $categories1 = $this->db->last_query();
		// return $query->result_array();
		$result = $query->result_array();
		foreach($result as $key=>$val){
			$result[$key]['cat2'] = json_decode($result[$key]['cat2']);
		}
		return $result;
	}
	public function get_json(){
		return '{"0":{"title":"bathroom","cat1_id":"1","cat2":[{"cat3":[{"title":"bath-brush","cat3_id":1},{"title":"bucket","cat3_id":2},{"title":"mug","cat3_id":3}],"title":"bathroom-plastic","cat2_id":1},{"cat3":[{"title":"mouthwash","cat3_id":4},{"title":"toothbrush","cat3_id":5},{"title":"toothpaste","cat3_id":6}],"title":"dentalare","cat2_id":2},{"cat3":[{"title":"face-pack","cat3_id":7},{"title":"face-scrub","cat3_id":8},{"title":"face-wash","cat3_id":9},{"title":"kajal","cat3_id":10},{"title":"lip-balm","cat3_id":11}],"title":"faceare","cat2_id":3},{"cat3":[{"title":"hair-brush","cat3_id":12},{"title":"hair-gels","cat3_id":13},{"title":"hair-oil","cat3_id":14},{"title":"mehendi","cat3_id":15},{"title":"shampoo","cat3_id":16}],"title":"hairare","cat2_id":4},{"cat3":[{"title":"deodorants","cat3_id":17},{"title":"gulab-jal","cat3_id":18},{"title":"handwash","cat3_id":19},{"title":"moisturiser","cat3_id":20},{"title":"shower-gels","cat3_id":21},{"title":"soaps","cat3_id":22},{"title":"talcum-powder","cat3_id":23}],"title":"personalare","cat2_id":5},{"cat3":[{"title":"after-shave","cat3_id":24},{"title":"blade","cat3_id":25},{"title":"razor","cat3_id":26},{"title":"shaving-accessories","cat3_id":27},{"title":"shaving-brush","cat3_id":28},{"title":"shaving-foam","cat3_id":29},{"title":"shaving-gels","cat3_id":30}],"title":"shaving-needs","cat2_id":6},{"cat3":[{"title":"hair-remover","cat3_id":31},{"title":"pedicure-tool","cat3_id":32},{"title":"sanitary-needs","cat3_id":33}],"title":"women-need","cat2_id":7}]},"1":{"title":"bedroom","cat1_id":"2","cat2":[{"cat3":[{"title":"antiseptic-liquid","cat3_id":34},{"title":"ayurvedic-medicine","cat3_id":35},{"title":"bandaid","cat3_id":36},{"title":"calcium-tablets","cat3_id":37},{"title":"chyawanprash","cat3_id":38},{"title":"condoms","cat3_id":39},{"title":"cough-remedy","cat3_id":40},{"title":"diet-nutrition","cat3_id":41},{"title":"earbud","cat3_id":42},{"title":"health-drink","cat3_id":43},{"title":"pain-relief","cat3_id":44},{"title":"safety-products","cat3_id":45}],"title":"health-wellness","cat2_id":8}]},"2":{"title":"cleaning","cat1_id":"3","cat2":[{"cat3":[{"title":"car-accessories","cat3_id":46},{"title":"car-perfume","cat3_id":47},{"title":"car-polish","cat3_id":48},{"title":"car-shampoo","cat3_id":49}],"title":"carare","cat2_id":9},{"cat3":[{"title":"air-freshener","cat3_id":50},{"title":"battery","cat3_id":51},{"title":"brooms","cat3_id":52},{"title":"cfl","cat3_id":53},{"title":"home-utilities","cat3_id":54},{"title":"insect-repellent","cat3_id":55},{"title":"tissue-paper","cat3_id":56},{"title":"torches","cat3_id":57},{"title":"wipes","cat3_id":58}],"title":"homeare","cat2_id":10},{"cat3":[{"title":"decorative-items","cat3_id":59},{"title":"dust-pan","cat3_id":60},{"title":"dustbin","cat3_id":61},{"title":"hanger","cat3_id":62},{"title":"toilet-brush","cat3_id":63}],"title":"household-plastics","cat2_id":11},{"cat3":[{"title":"detergent-bar","cat3_id":64},{"title":"detergent-powder","cat3_id":65},{"title":"liquid-detergent","cat3_id":66},{"title":"liquid-fabric-whiten","cat3_id":67},{"title":"liquid-stiffener","cat3_id":68}],"title":"laundry","cat2_id":12},{"cat3":[{"title":"shoe-polish","cat3_id":69}],"title":"shoeare","cat2_id":13},{"cat3":[{"title":"dishwash-bar","cat3_id":70},{"title":"liquid-dishwash","cat3_id":71},{"title":"scrub-pad","cat3_id":72}],"title":"utensilleaner","cat2_id":14}]},"3":{"title":"kids","cat1_id":"4","cat2":[{"cat3":[{"title":"baby-essentials","cat3_id":73},{"title":"baby-lotion","cat3_id":74},{"title":"baby-oil","cat3_id":75},{"title":"baby-powder","cat3_id":76},{"title":"baby-shampoo","cat3_id":77},{"title":"baby-soaps","cat3_id":78},{"title":"baby-wipes","cat3_id":79},{"title":"diapers","cat3_id":80},{"title":"feeding-bottle","cat3_id":81}],"title":"baby-andhildare","cat2_id":15},{"cat3":[{"title":"board-games","cat3_id":82},{"title":"building-blocks","cat3_id":83},{"title":"cricket-accessories","cat3_id":84},{"title":"dolls-and-accessorie","cat3_id":85},{"title":"educational-toys","cat3_id":86},{"title":"electronic-toys","cat3_id":87},{"title":"infant-toys","cat3_id":88},{"title":"kid-sports","cat3_id":89},{"title":"other-sports","cat3_id":90},{"title":"puzzles","cat3_id":91},{"title":"soft-toys","cat3_id":92},{"title":"vehicles","cat3_id":93}],"title":"toys","cat2_id":16}]},"4":{"title":"kitchen","cat1_id":"5","cat2":[{"cat3":[{"title":"biscuits","cat3_id":94},{"title":"cookies","cat3_id":95},{"title":"crackers","cat3_id":96},{"title":"cream-biscuits","cat3_id":97},{"title":"khari","cat3_id":98},{"title":"rusk","cat3_id":99},{"title":"wafers","cat3_id":100}],"title":"biscuitsookies","cat2_id":17},{"cat3":[{"title":"bread","cat3_id":101},{"title":"cereals","cat3_id":102},{"title":"eggs","cat3_id":103},{"title":"honey","cat3_id":104},{"title":"jams","cat3_id":105},{"title":"marmalade","cat3_id":106},{"title":"oats-muesli","cat3_id":107},{"title":"spreads","cat3_id":108}],"title":"breakfastereals","cat2_id":18},{"cat3":[{"title":"dates","cat3_id":109},{"title":"dry-fruit-raisin","cat3_id":110}],"title":"dry-fruits","cat2_id":19},{"cat3":[{"title":"instant-mixes","cat3_id":111},{"title":"soups","cat3_id":112}],"title":"instant-food","cat2_id":20},{"cat3":[{"title":"instant-noodles","cat3_id":113},{"title":"instant-pasta","cat3_id":114},{"title":"noodles","cat3_id":115},{"title":"pasta","cat3_id":116},{"title":"vermicelli","cat3_id":117}],"title":"pasta-noodles","cat2_id":21},{"cat3":[{"title":"italian-spice","cat3_id":118},{"title":"mayonnaise","cat3_id":119},{"title":"mouth-fresheners","cat3_id":120},{"title":"peanut-butter","cat3_id":121},{"title":"pickle","cat3_id":122},{"title":"salad-dressing","cat3_id":123},{"title":"sauce","cat3_id":124},{"title":"vinegar","cat3_id":125}],"title":"pickles-sauces-andon","cat2_id":22},{"cat3":[{"title":"agarbatti","cat3_id":126},{"title":"camphor","cat3_id":127},{"title":"cotton-batti","cat3_id":128},{"title":"hawan-samagri","cat3_id":129},{"title":"oil","cat3_id":130}],"title":"pooja-needs","cat2_id":23},{"cat3":[{"title":"dal","cat3_id":131},{"title":"edible-oil","cat3_id":132},{"title":"flour","cat3_id":133},{"title":"organic-kitchen","cat3_id":134},{"title":"rice","cat3_id":135},{"title":"salt-sugar","cat3_id":136},{"title":"suji","cat3_id":137}],"title":"pulses-rice-lentils","cat2_id":24},{"cat3":[{"title":"andhra","cat3_id":138},{"title":"gujrat","cat3_id":139},{"title":"kerala","cat3_id":140},{"title":"tamil","cat3_id":141}],"title":"regional-foods","cat2_id":25},{"cat3":[{"title":"fryums","cat3_id":142},{"title":"gift-pack","cat3_id":143},{"title":"instant-popcorn","cat3_id":144},{"title":"namkeen-mixtures","cat3_id":145},{"title":"papad","cat3_id":146},{"title":"south-indian-snacks","cat3_id":147}],"title":"snacks","cat2_id":26},{"cat3":[{"title":"ground-spices","cat3_id":148},{"title":"masala","cat3_id":149},{"title":"whole-spice","cat3_id":150}],"title":"spices","cat2_id":27},{"cat3":[{"title":"coffee","cat3_id":151},{"title":"dairy-whitener","cat3_id":152},{"title":"tea","cat3_id":153},{"title":"tea-bag","cat3_id":154}],"title":"teaoffee","cat2_id":28},{"cat3":[{"title":"baking-accessories","cat3_id":155},{"title":"bar-accessories","cat3_id":156},{"title":"bottle-flask","cat3_id":157},{"title":"cooker-pans","cat3_id":158},{"title":"cutlery","cat3_id":159},{"title":"plastic-products","cat3_id":160},{"title":"stainless-steel-uten","cat3_id":161}],"title":"utensils","cat2_id":29},{"cat3":[{"title":"cut-fruits","cat3_id":162},{"title":"cut-vegetables","cat3_id":163},{"title":"fresh-vegetables","cat3_id":164},{"title":"fruits","cat3_id":165}],"title":"vegetables","cat2_id":30}]},"5":{"title":"office","cat1_id":"6","cat2":[{"cat3":[{"title":"healthy-snacks","cat3_id":166},{"title":"microwave-snacks","cat3_id":167}],"title":"pantry-supplies","cat2_id":31},{"cat3":[{"title":"adhesive","cat3_id":168},{"title":"adhesive-tape","cat3_id":169},{"title":"color-palette","cat3_id":170},{"title":"colour-pen","cat3_id":171},{"title":"crayons","cat3_id":172},{"title":"drawing-box","cat3_id":173},{"title":"envelope","cat3_id":174},{"title":"eraser","cat3_id":175},{"title":"exam-kit","cat3_id":176},{"title":"glitter-glue","cat3_id":177},{"title":"glue-stick","cat3_id":178},{"title":"lunch-box","cat3_id":179},{"title":"mathematical-box","cat3_id":180},{"title":"notebook","cat3_id":181},{"title":"office-stationery","cat3_id":182},{"title":"paint-brush","cat3_id":183},{"title":"pen","cat3_id":184},{"title":"pencil","cat3_id":185},{"title":"pencil-box","cat3_id":186},{"title":"scale","cat3_id":187},{"title":"sharpener","cat3_id":188},{"title":"white-board","cat3_id":189}],"title":"stationery","cat2_id":32}]},"6":{"title":"pet","cat1_id":"7","cat2":[{"cat3":[{"title":"cat-food","cat3_id":190},{"title":"dog-accessories","cat3_id":191},{"title":"dog-food","cat3_id":192}],"title":"pet-food-accessories","cat2_id":33}]},"7":{"title":"refrigerator","cat1_id":"8","cat2":[{"cat3":[{"title":"energy-drinks","cat3_id":193},{"title":"ice-tea","cat3_id":194},{"title":"instant-drink-mix","cat3_id":195},{"title":"juices","cat3_id":196},{"title":"soda","cat3_id":197},{"title":"soft-drinks","cat3_id":198},{"title":"water","cat3_id":199}],"title":"beverages","cat2_id":34},{"cat3":[{"title":"butter","cat3_id":200},{"title":"cheese","cat3_id":201},{"title":"condensed-milk","cat3_id":202},{"title":"curd","cat3_id":203},{"title":"milk","cat3_id":204},{"title":"paneer","cat3_id":205}],"title":"dairy-products","cat2_id":35},{"cat3":[{"title":"fresh-non-veg","cat3_id":206},{"title":"frozen-green-peas","cat3_id":207},{"title":"frozen-mixed-vegetab","cat3_id":208},{"title":"frozen-nonveg","cat3_id":209},{"title":"frozen-nonveg-snacks","cat3_id":210},{"title":"frozen-snacks","cat3_id":211}],"title":"frozen-foods","cat2_id":36},{"cat3":[{"title":"baking-ingredients","cat3_id":212},{"title":"cakes","cat3_id":213},{"title":"candy","cat3_id":214},{"title":"chocolates","cat3_id":215},{"title":"indian-sweets","cat3_id":216},{"title":"sweet-mix","cat3_id":217},{"title":"syrups","cat3_id":218}],"title":"sweetshocolates","cat2_id":37}]}}';
	}
	public function update(){
		$data['subtitles'] = $this->input->post('subtitles');
		$this->db->where('video_id',$GLOBALS['video_id']);
		$query = $this->db->update('video_video_details',$data);
		if($this->db->affected_rows() == 0){
			if(!$this->get()){
				$data['video_id'] = $GLOBALS['video_id'];
				$query = $this->db->insert('video_video_details',$data);
			}
		}
		return 1;
	}
}
